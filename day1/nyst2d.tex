% pdflatex -shell-escape nyst2d && ac nyst2d.pdf &
\documentclass[t]{beamer}
\usepackage[utf8]{inputenc}

\usetheme{CCM}
\usepackage{epstopdf}  % handle EPS
\usepackage{bm}

% for MATLAB code display...
%\usepackage{mcode}   % matlabcentral, no nice colors (?) but can embed latex
% see: https://tex.stackexchange.com/questions/180222/how-to-change-font-size-for-specific-lstlisting
% OR...
\usepackage{xcolor}
\usepackage{minted}            % pygmentize code listings; needs -shell-escape
\definecolor{codebg}{rgb}{0.95,0.95,0.95}
\setminted{fontsize=\tiny,bgcolor=codebg}
\newminted[matc]{matlab}{}    % here matc is the macro name, matlab the language
\newmintinline[mati]{matlab}{}


% alex macros
\input{../templates/rgb}
\newcommand{\ft}[1]{\frametitle{#1}}
\newcommand{\bi}{\begin{itemize}}
\newcommand{\ei}{\end{itemize}}
\newcommand{\ben}{\begin{enumerate}}
\newcommand{\een}{\end{enumerate}}
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\ba}{\begin{align}}
\newcommand{\ea}{\end{align}}
\newcommand{\bc}{\begin{center}}
\newcommand{\ec}{\end{center}}
\newcommand{\mbf}[1]{{\bm #1}}           % requires bm package
\newtheorem{thm}{Theorem}
\newcommand{\ig}[2]{\includegraphics[#1]{#2}}
\newcommand{\tbox}[1]{{\mbox{\tiny #1}}}
\newcommand{\who}[1]{{\scriptsize \textcolor{darkgreen}{(#1)}}}  % cite
\newcommand{\com}[1]{{\scriptsize \textcolor{purple}{#1}}}      % comment
\newcommand{\co}[1]{{\scriptsize \tt #1}}          % code
\newcommand{\vg}{\vspace{2ex}}
\newcommand{\sg}{\vspace{1ex}}
\newcommand{\hg}{\vspace{0.5ex}}
\newcommand{\dr}[1]{{\color{darkred}#1}}    % for bullets
\newcommand{\rb}{\ensuremath{\textcolor{darkred}{\bullet\;}}\ }
\newcommand{\bmp}[1]{\begin{minipage}{#1}}
\newcommand{\bmpt}[1]{\begin{minipage}[t]{#1}}
\newcommand{\emp}{\end{minipage}}
\newcommand{\pig}[2]{\bmp{#1}\includegraphics[width=#1]{#2}\emp} % mp-fig, nogap
\newcommand{\pigm}[3]{\bmp{#1}\href{#3}{\includegraphics[width=#1]{#2}}\emp} % w/ movie
\newcommand{\ora}[1]{{\color{orange} #1}}
\newcommand{\gre}[1]{{\color{green} #1}}
\newcommand{\yel}[1]{{\color{yellow} #1}}
\newcommand{\sr}[1]{{\scriptsize #1}}
\newcommand{\eps}{\epsilon}
\newcommand{\qqquad}{\qquad\qquad}
\newcommand{\qqqquad}{\qqquad\qqquad}
\newcommand{\R}{\mathbb{R}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\N}{\mathbb{N}}
\newcommand{\emach}{\epsilon_\tbox{mach}}
\DeclareMathOperator{\im}{Im}
\DeclareMathOperator{\re}{Re}
\newcommand{\bigO}{{\cal O}}
\newcommand{\pO}{{\partial\Omega}}
\newcommand{\xx}{\mbf{x}}
\newcommand{\yy}{\mbf{y}}
\newcommand{\uu}{\mbf{u}}
\newcommand{\nn}{\mbf{n}}
\newcommand{\Srep}{{\cal S}}
\newcommand{\Drep}{{\cal D}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


% TO DO:

% potential theory

% beamerCCMtheme.sty : add noframe fragile option ? can't get working







%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{2D boundary integral equations and the Nystr\"om method}
\date{Computational Tools 2024 BIE workshop. Day 1, 6/10/24}
\author{\textbf{Alex Barnett}\inst{1}
and \textbf{Fruzsina Agocs}\inst{1}}
\institute{\inst{1} Center for Computational Mathematics, Flatiron Institute, Simons Foundation}

\begin{document}

\begin{frame}
	\titlepage
\end{frame}

\begin{frame}\ft{Integral equations on 1D interval}

  Given: i) function $\sigma(t)$ defined on interval $[0,2\pi)$,
\hfill\com{periodic: $\sigma(2\pi)=\sigma(0)$, etc}
    
\qquad\quad ii) ``kernel'' function $k(t,s)$ defined on square $[0,2\pi)^2$,

\sg
  
Integral {\em operator} $K$ acts on $\sigma$ to give another function $K\sigma$:

\hg

\bmp{3in}
\quad $(K\sigma)(t) := \int_0^{2\pi} k(t,s) \sigma(s) ds, \quad t \in [0,2\pi)$
\emp
\hfill
\bmp{1.4in}
\com{continuous analog of}

\vspace{-0.7ex}

\com{matrix-vector prod.\ $A\xx$}
\emp

\sg

\bmp{3in}
Integral {\em equation}: \quad $(I+K)\sigma =f$, ie
$$\sigma(t) + \int_0^{2\pi} k(t,s) \sigma(s) ds = f(t),
\quad t \in [0,2\pi)$$
  
  \emp
  \bmp{1.7in}
  \ig{width=1.7in}{skie}

\com{analog of lin.\ sys.\
  $A\xx=\mbf{b}$}
  \emp
  
  %write out:
  \sg

\quad \com{Fredholm ``second kind'' (due to presence of $I$, otherwise called ``first kind'')}

\sg

If kernel %$k(\cdot,\cdot)$
continuous, or ``weakly'' singular (integrable), $K$ is {\em compact}:

\rb
eigenvalues ($K\phi_k=\lambda_k\phi_k$) discrete, with $\lim_{k\to\infty}\lambda_k = 0$
%accumulate only at $0$

\quad \com{unless some $\lambda_k = -1$,
  %uniqueness:
  2nd kind IE has at most one soln: Nul $(I+K) = \{0\}$}
%  nullspace trivial

\rb Nul $(I+K) = \{0\}$
%has only trivial soln
\;$\Rightarrow$\;
{\em existence} of solution for {\em any} $f$ \hfill\com{Fredholm Alternative}

\quad \com{like square matrix (finite-dim), recall:\; uniqueness $\Rightarrow$
  consistent for any RHS}

Contrast 1st kind IE $K\sigma = f$ is ill-posed problem (unstable)!

%\rb $K$ is the norm limit of finite-rank operators \com{basically matrices}

\com{See references for lots of beautiful theory, precise statements}
%  see books for precise definitions}


%\com{called ``Fredholm'' (if $k$ integrable, eg only weakly singular),

  
%\rb treat domain as periodic: $2\pi$ glued back to $0$, so $f(2\pi) = f(0)$, etc

%Soon $t$ will {\em parameterize} a closed boundary curve  \com{eg $\xx(t) = (\cos t, \sin t)$}

\end{frame}


\begin{noframe}\ft{Nystr\"om discretization of 2nd kind IE on interval}

  Simplest quadrature for %$2\pi$-
  periodic funcs: periodic trapezoid rule (PTR)

\hg
 \quad  
$\int_0^{2\pi} f(t) dt
\approx
\sum_{j=1}^N \frac{2\pi}{N} f\bigl(\frac{2\pi j}{N} \bigr)
=
\sum_{j=1}^N w_j f(t_j)
$
\hfill \com{$w_j$=weights, \, $t_j$=nodes}

\hg

\com{For $f$ smooth, superalgebraically
  convergent
 (``spectral''): error $=\bigO(N^{-p})$ for any $p$}

\sg

Apply quad to integral in 2nd kind IE:
\hfill\com{call the resulting approx soln $\tilde\sigma$}

\sg

\quad $\tilde\sigma(t) + \sum_{j=1}^N k(t,t_j) w_j \tilde\sigma(t_j)  = f(t),
\quad t \in [0,2\pi) \qquad (*)$

\sg
  
Holds for all $t$; in particular, holds at each $t_i$, $i=1,\dots,N$, giving:

\sg

\quad $\sigma_i + \sum_{j=1}^N k(t_i,t_j)w_j \sigma_j = f(t_i),
\quad i=1,\dots,N$
\hfill\com{where $\sigma_j:=\tilde\sigma(t_j)$}

\sg

Write as: \qquad $A\bm{\sigma} = \bm{f}$
\hfill\com{$N\times N$ lin sys, entries $a_{ij} = \delta_{ij} + k(t_i,t_j)w_j$, and
  $f_j:=f(t_j)$}

\hg

\quad\com{solve? dense direct $\bigO(N^3)$;
  dense iter.\ $\bigO(N^2)$; fast iter.\ $\approx \bigO(N)$; fast direct
  $\approx \bigO(N^{(d+1)/2})$}

\quad\com{Why 2nd kind? eigs$(A)$ accumulate only at $+1$, iterative fast conv.}

\sg

Sometimes for BIE (eg, far-field eval), node values $\{\sigma_j\}_{j=1}^N$ suffice.

If not, interpolate from them to any $t\in[0,2\pi)$. Two approaches:

  \bmp{4in}
\rb \com{either: rearrange (*) to give $\tilde\sigma(t) = \dots$, called
    ``Nystr\"om interpolant'' (rare)}
  
\rb \com{or (common): use local high-order Lagrange
    (or global spectral) interpolation:}
\emp
\pig{.8in}{flocpoly}

\end{noframe}



\begin{frame}[fragile] \ft{Demo Nystr\"om on interval (1D)}  % need fragile for any verbatim env
\vspace{-5ex}
  
  \hfill\com{{\tt day1/code/nyst1d\_demos.m}}   % verb failed even w/ protect :(

% \begin{lstlisting}   % could add code comments with latex, eg:  % ยง\mcommentfont $k(t_i,t_j)w_j$ for $i,j=1,\dots,N$ยง
%\end{lstlisting}
  % Or use minted...
  \begin{matc}
kfun = @(s,t) exp(3*cos(t-s));                 % smooth convolutional kernel, periodic domain [0,2pi)
ffun = @(t) cos(5*t+1);                        % smooth data (RHS) func
N = 30;                                        % number of unknowns: should study convergence as N grows...
tj = 2*pi/N*(1:N); wj = 2*pi/N*ones(1,N);      % PTR nodes and weights, row vecs
A = eye(N) + bsxfun(kfun,tj',tj)*diag(wj);     % identity plus fill k(t_i,t_j)w_j for i,j=1..N
rhs = ffun(tj');                               % col vec
sigmaj = A\rhs;                                % dense direct square solve (pivoted LU), gives col vec
\end{matc}
  
  \pig{3.5in}{nyst_conv}
  \hfill
\bmp{1.1in}
\com{``self-convergence'':}

\vspace{-.5ex}

\com{use $N{=}40$ as ``true''}

\sg

\com{$f$ and $k$ smooth}

\vspace{-.5ex}

\com{$\Rightarrow\;$ $\sigma$ smooth}

\vspace{-.5ex}

\com{$\Rightarrow\;$ spectral conv?}
\emp

{\bf Thm.} \who{Anselone, Kress,\dots}: error at node values (and Nystr\"om
interpolant) same order as that of quadrature rule applied
to integrand $k(t,\cdot)\sigma$.
% $\{\sigma_j\}_{j=1}^N$ 
%  \quad\com{Eg: $k$ and $f$ smooth $\;\Rightarrow\;$  $\sigma$ smooth
%    $\;\Rightarrow\;$ PTR Nystr\"om spectral conv.}
  


\pause
\sg

% attempt to label graphs
%\hspace{1.8in} \mati|ffun = @(t) abs(sin(t))| \hfill \mati|kfun = @(s,t) 10*sin(abs(t-s)/2).^3|

\bmp{2.3in}
\rb Then, $f$ or $k$ nonsmooth?

worse (here {\em algebraic})
convergence using plain PTR rule:

\sg

\com{Qu: why does order appear to improve at end?}

\emp
\hfill\pig{2.3in}{nyst_nonsm}

\end{frame}



\begin{noframe}\ft{Fundamental solution in $\R^2$}

Eg PDE: Poisson eqn $\Delta u = g$
\hfill\com{$\Delta:=(\partial/\partial x_1)^2+(\partial/\partial x_2)^2$ Laplacian}

\com{Notation: $\xx := (x_1,x_2) \in \R^2$ is a point. This frees up $\yy \in\R^2$ as another point (not y-coord!)}

\com{Not well-posed prob. unless add BC!  BIEs are good for {\em homogeneous} PDEs (driving $g\equiv 0$)}
  
\bmp{1.5in}
Eg well-posed$^*$ BVP:

\sg

\com{$^*$exists, unique,
  continuous w.r.t. data}
\emp
\bmp{2.3in}
$\Delta u = 0 \mbox{ in } \Omega$ \quad \com{PDE ($u$ harmonic)}

\quad $u = f \mbox{ on } \Gamma$ \quad \com{Dirichlet BC}
\emp
\pig{.7in}{domain}

Laplace fundamental soln: $\Phi(\xx,\yy) = \frac{1}{2\pi}\log \frac{1}{r}$
where $r := \|\xx-\yy\|$
\pig{.5in}{fundsol}

\quad obeys $-\Delta_\xx \Phi = -\Delta_\yy \Phi = \delta_\xx$
\quad \com{ie $\Phi$ harmonic except unit point-mass at origin}

\com{Normal $\nn$ points outwards, $\|\nn\|=1$ \quad normal deriv. notation $u_n := \nn\cdot\nabla u$}

Green's 2nd identity: $\int_\Gamma vu_n - v_n u \, ds = \int_\Omega v\Delta u - (\Delta v)u \, d\yy$ \hfill \com{calculus}

\quad\com{warm-up: set $u = $ BVP soln, $v\equiv 1$, G2I becomes $\int_\Gamma u_n ds \, - 0 = 0 - 0$: so $u$ has zero {\em flux}}

\bmp{4in}
\quad\com{more fun: fix ``target'' $\xx\in\Omega$, let $v=\Phi(\xx,\cdot)$, G2I gives:}

Green's representation formula \com{``GRF'', interior version, for any $\xx\in\Omega$:}

$ \int_\Gamma \Phi(\xx,\yy) u_n(\yy) - \frac{\partial \Phi(\xx,\yy)}{\partial n_\yy} u(\yy) \, ds_\yy =
u(\xx)$

\quad \com{Gets soln from ``Cauchy data'' $(u,u_n)|_\Gamma$.
  %  Works for all PDEs this week}
  Helmholtz, Stokes, Maxwell versions}
% *** edit

% our first layer pots

% HW: show GRF for Helmholtz, assuming Phi is FS  (k^2 terms cancel)

\emp
\pig{.7in}{domainGRF}

%\com{reconstruct harmonic func from bdry data %$u_\Gamma$, $u_n|_\Gamma$ alone}

\end{noframe}


\begin{frame}\ft{Layer potentials and jump relation}

  LPs

  ugh, make new pics for Laplace?
  
  ${\cal S}$ vs $S$
  
  JRs

  physical meaning: charge sheet, voltage jump

  recap GRF in LP notation
  
\end{frame}

\begin{frame}\ft{BIEs}

  Derive direct BIE via GRF

Derive indirect BIE via ansatz $u = {\cal D}\sigma$
  
  
Table: direct vs indirect pros/cons

we prefer

\end{frame}

\begin{frame}\ft{Parameterization to get a 1D IE}

  $\xx(t)$

  change of var

  back to familiar IE on $[0,2\pi)$ periodic: apply PTR + Nystr\"om
  
\end{frame}

\begin{frame}\ft{Testing your codes}

Test GRF first for a known soln

\end{frame}

\begin{frame}\ft{Exterior Laplace}

subtlety of decay in 2D

mixed rep

\end{frame}

\begin{frame}\ft{Helmholtz}

  $(\Delta + \kappa^2)u = 0$ arises from scalar wave equation $u_{tt}- \Delta u = 0$

  $\kappa$ ``wavenumber''; wavelength $\lambda = 2\pi/\kappa$
  
  Also used for 2D Maxwell ($z$-invar); TE vs TM

  

  

  
\end{frame}



\begin{frame}\ft{Recap}

TO DO
  
  \rb

  \rb Nystr\"om discretization gets $\sigma(t_j)$ \com{interpolate from them to other $t$}

  \rb Fancier quadratures needed for singular kernels and/or close eval

\rb Nystr\"om is not the only discr. meth: Galerkin, collocation.
but: simplest and no less accurate


  
\end{frame}


\begin{frame}\ft{Resources}  % RRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRRR

Many numerical analysis (mathematical flavor), particularly:

\hg

\rb {\em Linear Integral Equations}, R. Kress, (1999, Springer). Ch. 6 \& 12.

\hg

\rb {\em The Numerical Solution of Integral Equations of the Second Kind},
K. E. Atkinson, (1997, CUP).

% *** add Sauter-Schwab

% *** Ladyzhenskaya, Hsiao--Wendland for Stokes?


\sg

Fewer on the practical/tutorial side:

\hg

\rb ``High-order accurate methods for Nystr\"om discretization of integral equations on smooth curves in the plane'', S Hao, AH Barnett, PG Martinsson, P Young.
{\em Adv. Comput. Math.} {\bf 40}, 245--272 (2014).

\hfill \com{goes beyond these slides for logarithmic singularities,
  eg SLP}

\hg

\rb \url{https://users.flatironinstitute.org/~ahb/BIE/}

\hg

\rb \url{https://github.com/ahbarnett/BIEbook} \hfill \com{in progress\dots}

\end{frame}


\end{document}
